% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dnds_state_contrast.R
\name{dnds_state_contrast}
\alias{dnds_state_contrast}
\title{dN/dS state contrasts via (mixed) logistic regression}
\usage{
dnds_state_contrast(
  dnds_table_file = NULL,
  comparison_file = NULL,
  output_dir = getwd(),
  in_suffix = NULL,
  dnds_col = "dNdS",
  group_col = "group",
  random_effect_col = NULL,
  pos_threshold = 1,
  neutral_lower = 0.9,
  neutral_upper = 1.1,
  max_dnds = 10,
  filter_expr = NULL,
  min_n_per_group = 50,
  fdr_method = c("BH", "BY", "none"),
  make_plots = TRUE,
  out_prefix = NULL
)
}
\arguments{
\item{dnds_table_file}{Path to a TSV with dN/dS + group column (single mode).}

\item{comparison_file}{Optional batch file; if provided, reads per-comparison
tables from file.path(output_dir, comparison_name, in_suffix).
Must have a column 'comparison_name' (header or first column).}

\item{output_dir}{Root dir for batch outputs (default getwd()).}

\item{in_suffix}{Filename within each comparison folder (default "\if{html}{\out{<comp>}}_dnds.tsv").}

\item{dnds_col}{Name of dN/dS column (default "dNdS").}

\item{group_col}{Name of grouping column (e.g., "subgenome", "species", "region") (default "group").}

\item{random_effect_col}{Optional column for random intercept (e.g., "orthogroup") (default NULL).}

\item{pos_threshold}{Numeric; dN/dS > this is "Positive" (default 1).}

\item{neutral_lower}{Numeric; lower bound for "Neutral" (default 0.9).}

\item{neutral_upper}{Numeric; upper bound for "Neutral" (default 1.1).}

\item{max_dnds}{Numeric; drop rows with dN/dS >= max_dnds or NA (default 10).}

\item{filter_expr}{Optional expression evaluated in the table to filter rows.}

\item{min_n_per_group}{Minimum rows required per group to run comparisons (default 50).}

\item{fdr_method}{One of "BH","BY","none" (default "BH").}

\item{make_plots}{Logical; if TRUE, writes forest plot (default TRUE).}

\item{out_prefix}{Output prefix (default derived from file basename).}
}
\value{
Invisibly returns list with:
\itemize{
\item results: data.frame of contrasts
\item paths: written TSV + plot paths
}
}
\description{
Compares the frequency of dN/dS "states" across groups using one-vs-rest
logistic regression, optionally with a random intercept (mixed model).
}
\details{
States are:
\itemize{
\item Positive:  dN/dS > pos_threshold
\item Neutral:   neutral_lower <= dN/dS <= neutral_upper
\item Purifying: dN/dS < neutral_lower
}

Runs all pairwise contrasts (A vs B) and returns odds ratios with CIs and FDR.
Produces a forest plot faceted by state and reference group.
}

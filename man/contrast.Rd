% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/contrast.R
\name{contrast}
\alias{contrast}
\title{Pairwise dN/dS contrasts (genome-wide by default; optional region restriction)}
\usage{
contrast(
  dnds_annot_file_a = NULL,
  dnds_annot_file_b = NULL,
  comparison_file = NULL,
  contrast_file = NULL,
  output_dir = getwd(),
  regions_bed = NULL,
  region_seq_col = NULL,
  region_start_col = NULL,
  region_end_col = NULL,
  region_name_col = NULL,
  merge_cols = NULL,
  sides = c("query", "subject"),
  filter_expr = NULL,
  max_dnds = 10,
  ci_method = c("normal", "bootstrap"),
  n_boot = 1000,
  make_plots = TRUE,
  pos_threshold = 1
)
}
\arguments{
\item{dnds_annot_file_a}{Path to first \if{html}{\out{<compA>}}_dnds_annot.tsv (single-contrast).}

\item{dnds_annot_file_b}{Path to second \if{html}{\out{<compB>}}_dnds_annot.tsv (single-contrast).}

\item{comparison_file}{Path to whitespace-delimited file with columns:
comparison_name, query_fasta, query_gff, subject_fasta, subject_gff.}

\item{contrast_file}{Optional file defining contrasts (4-col or 5-col layout).
Note: side columns are ignored in global mode (regions_bed = NULL).}

\item{output_dir}{Root directory containing per-comparison folders (batch mode).}

\item{regions_bed}{Optional BED-like file of regions. If provided, restrict to
genes overlapping regions (regional mode). If NULL, run genome-wide (default).}

\item{region_seq_col, region_start_col, region_end_col, region_name_col}{Column names in regions_bed for seqname/start/end/label.}

\item{merge_cols}{Optional character vector of column names used to match rows
across comparisons. If NULL, defaults are used (see Matching behavior above).}

\item{sides}{Character vector among c("query","subject") indicating which side(s)
to evaluate in auto-all-pairs mode and single-contrast mode. Ignored in global
mode (regions_bed = NULL).}

\item{filter_expr}{Optional character with a logical expression evaluated in
each dNdS table prior to region labeling and merging.}

\item{max_dnds}{Numeric. Drop rows with dNdS >= max_dnds or NA dNdS (default 10).}

\item{ci_method}{One of "normal" (mean +/- 1.96*SE) or "bootstrap" (percentile).}

\item{n_boot}{Integer; number of bootstrap resamples if ci_method = "bootstrap".}

\item{make_plots}{Logical; if TRUE, write paired scatter, delta histogram,
and delta ECDF per contrast.}

\item{pos_threshold}{Numeric threshold for calling "positive selection"
(genes with dN/dS > pos_threshold are counted in the enrichment test; default 1).}
}
\value{
Invisibly, a character vector of summary TSV paths (one per contrast x side_tag).
}
\description{
Compare dN/dS between pairs of dNdS annotation files using paired nonparametric
tests. For each contrast (compA vs compB), the function:
\itemize{
\item filters each table by max_dnds and optional filter_expr,
\item (optional) restricts to genes in regions_bed (side-aware),
\item matches rows across comparisons,
\item computes delta = dNdS_A - dNdS_B per matched gene,
\item runs a Wilcoxon signed-rank test on delta,
\item runs Fisher's exact test for enrichment of dN/dS > pos_threshold in A vs B,
\item writes a TSV summary + optional plots.
}
}
\details{
Default behavior is genome-wide contrasts (regions_bed = NULL).

Matching behavior:
\itemize{
\item Global (regions_bed = NULL): merge on c("query_id","subject_id") by default
(recommended). You may override with merge_cols.
\item Regional (regions_bed provided): merge on side-aware focal IDs by default
(query_id if side == "query", else subject_id). You may override with merge_cols.
}

Modes:
\enumerate{
\item Single-contrast: supply dnds_annot_file_a and dnds_annot_file_b.
\item Batch + explicit contrasts: comparison_file + contrast_file + output_dir.
\item Batch + auto-all-pairs: comparison_file + contrast_file = NULL.
}
}

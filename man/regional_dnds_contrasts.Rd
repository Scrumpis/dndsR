% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/regional_dnds.R
\name{regional_dnds_contrasts}
\alias{regional_dnds_contrasts}
\title{Pairwise regional dN/dS contrasts (Wilcoxon signed-rank + dN/dS>threshold enrichment)}
\usage{
regional_dnds_contrasts(
  dnds_annot_file_a = NULL,
  dnds_annot_file_b = NULL,
  comparison_file = NULL,
  contrast_file = NULL,
  output_dir = getwd(),
  regions_bed,
  region_seq_col = NULL,
  region_start_col = NULL,
  region_end_col = NULL,
  region_name_col = NULL,
  merge_cols = NULL,
  sides = c("query", "subject"),
  filter_expr = NULL,
  max_dnds = 10,
  ci_method = c("normal", "bootstrap"),
  n_boot = 1000,
  make_plots = TRUE,
  pos_threshold = 1
)
}
\arguments{
\item{dnds_annot_file_a}{Path to first \if{html}{\out{<compA>}}_dnds_annot.tsv (single-contrast).}

\item{dnds_annot_file_b}{Path to second \if{html}{\out{<compB>}}_dnds_annot.tsv (single-contrast).}

\item{comparison_file}{Path to whitespace-delimited file with columns:
comparison_name, query_fasta, query_gff, subject_fasta, subject_gff.
Used in batch mode together with contrast_file or auto-all-pairs.}

\item{contrast_file}{Optional path to a whitespace-delimited file defining pairwise
contrasts. Supported column layouts:
\itemize{
\item 4 columns: contrast_name, compA, compB, side
(side is applied to both compA and compB)
\item 5 columns: contrast_name, compA, compA_side, compB, compB_side
(sides may differ per comparison)
}}

\item{output_dir}{Root directory containing per-comparison folders (batch mode).}

\item{regions_bed}{Path to BED-like file of regions with at least 3 columns:
seqname, start, end, and optionally a name/label column.}

\item{region_seq_col, region_start_col, region_end_col, region_name_col}{Column names in regions_bed for seqname/start/end/label.}

\item{merge_cols}{Character vector of column names used to match rows across
comparisons (e.g. "query_id", "subject_id", or an orthogroup ID). If NULL
(default), the function first tries "query_id" and then "subject_id",
requiring the chosen column to be present in both dNdS tables.}

\item{sides}{Character vector among c("query","subject") indicating which side(s)
to evaluate in auto-all-pairs mode and single-contrast mode. Ignored when
contrast_file explicitly specifies per-comparison sides.}

\item{filter_expr}{Optional character with a logical expression evaluated in
each dNdS table before merging (e.g., "q_seqname == s_seqname & dNdS < 5").}

\item{max_dnds}{Numeric. Drop rows with dNdS >= max_dnds or NA dNdS (default 10).}

\item{ci_method}{One of "normal" (mean +/- 1.96*SE) or "bootstrap" (percentile).}

\item{n_boot}{Integer; number of bootstrap resamples if ci_method = "bootstrap".}

\item{make_plots}{Logical; if TRUE, write a paired scatter and delta histogram
per contrast and side-combination.}

\item{pos_threshold}{Numeric threshold for calling "positive selection"
(genes with dN/dS > pos_threshold are counted in the enrichment test; default 1).}
}
\value{
Invisibly, a character vector of summary TSV paths (one per contrast).
Each TSV has columns:
contrast_name, compA, compB, sideA, sideB, n,
mean_dnds_A, median_dnds_A,
mean_dnds_B, median_dnds_B,
mean_delta, median_delta,
delta_sd, delta_se, delta_ci_lower, delta_ci_upper,
wilcox_p_value,
n_pos_A, n_nonpos_A, frac_pos_A,
n_pos_B, n_nonpos_B, frac_pos_B,
pos_threshold,
fisher_p_A_gt_B_dnds_gt_pos_threshold.
}
\description{
Compare dN/dS between pairs of dNdS annotation files within specified genomic
regions using paired nonparametric tests. For each contrast (compA vs compB),
the function:
\itemize{
\item restricts to genes in the provided regions (per-comparison query/subject side),
\item matches rows across comparisons by user-specified ID columns,
\item computes delta = dNdS_A - dNdS_B per matched gene,
\item runs a Wilcoxon signed-rank test on delta,
\item summarizes statistics and writes a TSV (and optional plots) per contrast.
}
}
\details{
In addition, it tests whether compA is enriched for putatively positively selected
genes (dN/dS > pos_threshold) compared to compB using Fisher's exact test on:

row1-compA: n_pos_A, n_nonpos_A
row2-compB: n_pos_B, n_nonpos_B

with alternative = "greater" (H1: prop_A > prop_B).

Modes:
\enumerate{
\item Single-contrast: supply dnds_annot_file_a and dnds_annot_file_b.
\item Batch + explicit contrasts: comparison_file + contrast_file + output_dir.
\item Batch + auto-all-pairs: comparison_file + contrast_file = NULL.
}
}

% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dnds_ideogram.R
\name{dnds_ideogram}
\alias{dnds_ideogram}
\title{Genome-wide dN/dS ideograms (RIdeogram) for query/subject}
\usage{
dnds_ideogram(
  dnds_annot_file = NULL,
  comparison_file = NULL,
  output_dir = getwd(),
  sides = c("query", "subject"),
  window_size = 3e+05,
  max_dnds = 10,
  filter_expr = NULL,
  make_png = TRUE,
  overwrite = FALSE,
  keep_intermediate = FALSE,
  chr_strip_leading_chr0 = FALSE,
  chr_strip_leading = NULL,
  chr_strip_trailing = NULL,
  chr_case_insensitive = TRUE,
  restrict_gff_to_gene = FALSE,
  verbose = TRUE,
  ...
)
}
\arguments{
\item{dnds_annot_file}{Path to a single prebuilt intermediate table that
already contains \code{q_chr/q_gene_start} or \code{s_chr/s_gene_start}
(single mode). Most users should prefer batch mode via \code{comparison_file}.}

\item{comparison_file}{Whitespace-delimited file with columns:
\code{comparison_name}, \code{query_fasta}, \code{query_gff},
\code{subject_fasta}, \code{subject_gff}. (Header optional.) In batch mode,
the function will look for the dN/dS table inside
\code{file.path(output_dir, comparison_name)} using the first existing among
\code{<comp>_dnds.tsv}, \code{<comp>_dnds_annot.tsv}, \code{<comp>_merged.tsv},
build the intermediate by joining coordinates from the GFFs, and plot.}

\item{output_dir}{Root directory containing per-comparison folders in batch
mode. Default: current working directory.}

\item{sides}{Character vector among \code{c("query","subject")}. Default both.}

\item{window_size}{Integer window size (bp) for binning genes (default \code{300000}).}

\item{max_dnds}{Drop rows with \code{dNdS >= max_dnds} or \code{NA} (default \code{10}).}

\item{filter_expr}{Optional character with a logical expression evaluated in
the augmented table (e.g. \code{"q_chr == s_chr"}). Rows failing are removed.
(No chromosome mapping is performed; this is a raw filter.)}

\item{make_png}{Logical; if \code{TRUE} (default) also write a PNG via \code{convertSVG()}.}

\item{overwrite}{Logical; if \code{FALSE} (default) skip when outputs exist.}

\item{keep_intermediate}{Logical; keep the generated
\code{<comp>_ideogram_input.tsv} (default \code{FALSE}).}

\item{chr_strip_leading_chr0}{Logical; optionally strip leading "chr" and optional "0"
(e.g., \code{chr01}->\code{1}). Case-insensitive by default. Default \code{FALSE}.}

\item{chr_strip_leading}{Character (regex) to strip from the start (e.g., \code{"Cf0"}).
Default \code{NULL} (no stripping).}

\item{chr_strip_trailing}{Character (regex) to strip from the end (e.g., \code{"_random"}).
Default \code{NULL} (no stripping).}

\item{chr_case_insensitive}{Logical; apply the above stripping case-insensitively
(default \code{TRUE}).}

\item{restrict_gff_to_gene}{Logical; if \code{TRUE}, only use GFF rows with \code{type=="gene"}
when indexing coordinates. Default \code{FALSE}.}

\item{verbose}{Logical; print progress.}

\item{...}{Additional arguments passed to \code{RIdeogram::ideogram()}, such
as layout or color options. Arguments that would override core mappings
(\code{karyotype}, \code{overlaid}, \code{label}) are ignored.}
}
\value{
Invisibly, a character vector of output file paths written.
}
\description{
For each comparison, reads a dN/dS table (first existing among
\code{<comp>_dnds.tsv}, \code{<comp>_dnds_annot.tsv}, or \code{<comp>_merged.tsv}),
derives genomic coordinates for \code{query_id}/\code{subject_id} from the
provided GFFs (first attribute match per ID), writes a temporary
\code{<comp>/<comp>_ideogram_input.tsv} containing \code{q_chr},
\code{q_gene_start}, \code{s_chr}, \code{s_gene_start}, and then generates
chromosome ideograms per side with two heatmaps: inverted negative selection
(\code{dNdS < 1}) overlaid, and positive selection (\code{dNdS >= 1}) as the
label heatmap. Outputs are \code{<comp>_{query|subject}_ideogram.{svg,png}}.
}
\details{
Coordinates are derived by parsing the GFF attribute column and matching common
keys (\code{ID}, \code{gene_id}, \code{Parent}, \code{Name}, \code{gene},
\code{locus_tag}, \code{geneID}); the first occurrence of an ID is used,
taking seqid (col 1) and start (col 4). Header lines beginning with \code{'#'}
are ignored. Chromosome labels are kept \emph{raw} by default; optional
normalization flags can be used to strip site-specific prefixes/suffixes.
}

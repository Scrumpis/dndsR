% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ipr_enrichment.R
\name{ipr_enrichment}
\alias{ipr_enrichment}
\title{InterPro (IPR) enrichment (Fisher) for query/subject terms in dNdS results}
\usage{
ipr_enrichment(
  dnds_annot_file = NULL,
  comparison_file = NULL,
  output_dir = getwd(),
  sides = c("query", "subject"),
  pos_threshold = 1,
  max_dnds = 10,
  filter_expr = NULL,
  make_plots = TRUE,
  top_n = 20,
  drop_rows_without_term = TRUE,
  min_total = 0,
  min_pos = 0,
  fdr_method = c("BH", "IHW", "qvalue", "none"),
  alpha = 0.05,
  include_types = NULL,
  stratify_by_type = FALSE,
  types = NULL,
  adjust_scope = c("global", "per_type"),
  entries_source = c("auto", "local", "remote", "none"),
  entries_path = NULL,
  entries_url = "https://ftp.ebi.ac.uk/pub/databases/interpro/current_release/entry.list",
  entries_timeout_s = 20,
  keep_unmatched = TRUE
)
}
\arguments{
\item{dnds_annot_file}{Path to a single <comp>_dnds_annot.tsv (single mode).}

\item{comparison_file}{Path to whitespace-delimited file (tabs/spaces; header or not)
with columns: comparison_name, query_fasta, query_gff, subject_fasta, subject_gff.
If provided, batch mode reads:
file.path(output_dir, comparison_name, paste0(comparison_name, "_dnds_annot.tsv")).}

\item{output_dir}{Root directory containing per-comparison folders (batch mode).}

\item{sides}{Character vector among c("query","subject"). Default both.}

\item{pos_threshold}{Numeric. dNdS > pos_threshold defines "positive" (default 1).}

\item{max_dnds}{Numeric. Drop rows with dNdS >= max_dnds (default 10) or NA dNdS.}

\item{filter_expr}{Optional character with a logical expression evaluated in the data
(e.g., "q_seqname == s_seqname").}

\item{make_plots}{Logical; if TRUE, write a top-N bubble plot per result (default TRUE).}

\item{top_n}{Integer; number of rows for plot (default 20).}

\item{drop_rows_without_term}{Logical; if TRUE (default), rows with no IPR term are
removed from BOTH positives and background (annotation-aware universe).}

\item{min_total}{Minimum total occurrences (pos+nonpos) required for a term (default 0).}

\item{min_pos}{Minimum positive occurrences required for a term (default 0).}

\item{fdr_method}{One of "BH","IHW","qvalue","none". Defaults to "BH".
If "IHW"/"qvalue" is chosen but the package is missing, falls back to "BH".}

\item{alpha}{FDR level for IHW weighting (default 0.05).}

\item{include_types}{Optional character vector of InterPro ENTRY_TYPE values to keep
in pooled mode (e.g., c("Domain","Homologous_superfamily")). Ignored if stratified.}

\item{stratify_by_type}{Logical. If TRUE, run separate analyses per ENTRY_TYPE with
type-specific backgrounds (recommended for apples-to-apples). Default FALSE.}

\item{types}{Character vector of ENTRY_TYPEs to analyze when stratified; default NULL
= infer from data present in q_ipr/s_ipr.}

\item{adjust_scope}{When stratified, "global" (one BH across all tests) or "per_type".}

\item{entries_source}{Where to load InterPro entries from:
"auto" (bundled static; default), "local" (use entries_path),
"remote" (download; falls back to bundled), or "none" (skip metadata).}

\item{entries_path}{Optional path to a TSV copy of InterPro entry.list
(columns: ENTRY_AC, ENTRY_TYPE, ENTRY_NAME). Used for "auto"/"local".}

\item{entries_url}{Remote URL for current InterPro entry.list (default EBI).}

\item{entries_timeout_s}{Numeric timeout (seconds) for remote fetch (default 20).}

\item{keep_unmatched}{Keep IPRs not found in entry.list when filtering (default TRUE).}
}
\value{
In single mode: (invisibly) list of output TSV paths.
        In batch mode:  (invisibly) vector of output TSV paths across comparisons.
        Each TSV includes: IPR, ENTRY_TYPE, ENTRY_NAME, pos_count, nonpos_count,
        pos_total, nonpos_total, odds_ratio, p_value, p_adj, total_count, label,
        side, comparison.
}
\description{
Reads <comp>/<comp>_dnds_annot.tsv and tests enrichment of IPR terms (q_ipr / s_ipr)
among positively selected pairs (dNdS > pos_threshold) vs the filtered background.
Adds InterPro metadata (ENTRY_TYPE/ENTRY_NAME) and supports pooled vs per-type analyses.
}

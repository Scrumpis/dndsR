% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gene_state_contrast.R
\name{gene_state_contrast}
\alias{gene_state_contrast}
\title{Gene-level dN/dS state contrasts across groups (aggregate across comparisons)}
\usage{
gene_state_contrast(
  dnds_annot_files = NULL,
  comparison_file = NULL,
  output_dir = getwd(),
  focal_sides = c("query", "subject"),
  group_mode = c("subgenome", "custom"),
  group_col = NULL,
  dnds_col = "dNdS",
  agg_fun = c("median", "mean"),
  min_pairs = 2,
  pos_threshold = 1,
  neutral_lower = 0.9,
  neutral_upper = 1.1,
  filter_expr = NULL,
  max_dnds = 10,
  random_effect_col = NULL,
  min_n_per_group = 200,
  fdr_scope = c("block", "global"),
  fdr_method = c("BH", "BY", "none"),
  make_plots = TRUE,
  plot_format = c("pdf", "png")
)
}
\arguments{
\item{dnds_annot_files}{Optional character vector of one or more *_dnds_annot.tsv files.
If supplied, runs in "explicit files" mode.}

\item{comparison_file}{Optional path (batch mode) used throughout dndsR.
If provided, reads <output_dir>/<comparison_name>/<comparison_name>_dnds_annot.tsv.}

\item{output_dir}{Root directory containing per-comparison folders (batch mode).}

\item{focal_sides}{Which genes to treat as focal observations: c("query","subject") (default both).
Use both for B/C/D gene-level aggregation across all comps.}

\item{group_mode}{"subgenome" derives group from q_gff_seqname/s_gff_seqname like "Chr01C" -> "C",
or "custom" uses group_col from the data you provide (after aggregation).}

\item{group_col}{If group_mode="custom", the group column name to use (must exist after aggregation).}

\item{dnds_col}{Column name holding pairwise dN/dS (default "dNdS").}

\item{agg_fun}{Aggregation function across partners per gene: "median" (default) or "mean".}

\item{min_pairs}{Minimum number of pairwise observations required per gene (default 2).}

\item{pos_threshold}{Numeric; dN/dS > pos_threshold defines "Positive" (default 1).}

\item{neutral_lower}{Numeric; lower bound for "Neutral" (default 0.9).}

\item{neutral_upper}{Numeric; upper bound for "Neutral" (default 1.1).}

\item{filter_expr}{Optional character expression evaluated in the raw pairwise tables.}

\item{max_dnds}{Drop rows with dN/dS >= max_dnds or NA (default 10).}

\item{random_effect_col}{Optional column for random intercept (e.g., gene family / orthogroup).
NOTE: this column must exist in the \emph{aggregated gene table}. If you want this,
you typically merge it in beforehand or add it via your pipeline outputs.}

\item{min_n_per_group}{Minimum number of genes per group to keep (default 200).}

\item{fdr_scope}{Adjust p-values within each (state, reference) block ("block")
or across all tests ("global"). Default "block".}

\item{fdr_method}{One of "BH","BY","none". Default "BH".}

\item{make_plots}{Logical; if TRUE, write a forest plot (default TRUE).}

\item{plot_format}{One of "pdf","png". Default "pdf".}
}
\value{
Invisibly:
list(gene_table = ..., results_df = ..., out_tsv = ..., out_plot = ...)
In batch mode (comparison_file), writes outputs to file.path(output_dir, "gene_level_state_contrast").
}
\description{
This is the "gene-centric" version of dnds_state_contrast().
Instead of modeling per \emph{pairwise row} (one ortholog pair), it:
\enumerate{
\item stacks one or more \if{html}{\out{<comp>}}_dnds_annot.tsv tables,
\item converts them into \emph{gene-level} observations by taking each gene on the
query and/or subject side and attaching the pairwise dN/dS value,
\item aggregates across all pairwise partners per gene (median/mean),
\item bins each gene into a state (Positive / Neutral / Purifying),
\item runs one-vs-rest (mixed) logistic regression across subgenomes/groups.
}
}
\details{
For Chenopodium BBCCDD this is what you want if you're trying to say:
"Genes on subgenome D are more likely to be in dN/dS>1 than B or C"
because each gene's state is determined from its distribution across partners.

Requires standard dndsR columns:
query_id, subject_id, dNdS, q_gff_seqname, s_gff_seqname
}

% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/term_enrichment.R
\name{term_enrichment}
\alias{term_enrichment}
\title{Term enrichment (Fisher test) for query/subject terms in dNdS results}
\usage{
term_enrichment(
  dnds_annot_file = NULL,
  comparison_file = NULL,
  output_dir = getwd(),
  terms = NULL,
  exclude_terms = c("ipr", "go"),
  sides = c("query", "subject"),
  pos_threshold = 1,
  max_dnds = 10,
  filter_expr = NULL,
  make_plots = TRUE,
  top_n = 20,
  drop_rows_without_term = TRUE,
  min_total = 0,
  min_pos = 0,
  fdr_method = c("BH", "IHW", "qvalue", "none"),
  alpha = 0.05,
  term_sep = ";",
  term_seps = c(";", "|", ","),
  term_blocklist = c("attributes", "attribute", "attr", "notes", "note", "description",
    "product", "name", "id", "gene_id", "transcript_id", "parent", "dbxref", "source",
    "target", "type", "seqname", "seqid", "start", "end", "strand", "phase", "biotype",
    "class", "len"),
  exclude_ids = NULL,
  term_trees = NULL,
  exclude_descendants = FALSE,
  exclude_descendants_depth = Inf,
  exclude_descendants_limit = 5000,
  term_metadata = NULL,
  keep_unmatched_ids = TRUE,
  dnds_file = NULL
)
}
\arguments{
\item{dnds_annot_file}{Path to a single \if{html}{\out{<comp>}}_dnds_annot.tsv (single mode).}

\item{comparison_file}{Path to whitespace-delimited file (tabs/spaces; header or not)
with columns: comparison_name, query_fasta, query_gff, subject_fasta, subject_gff.
If provided, batch mode reads:
file.path(output_dir, comparison_name, paste0(comparison_name, "_dnds_annot.tsv")).}

\item{output_dir}{Root directory containing per-comparison folders (batch mode).}

\item{terms}{Character vector of term types to test (e.g., c("kegg","pfam")).
Default NULL = auto-detect among {kegg, panther, pfam, tigrfam, cog} and any custom
q_\emph{/s_} term columns present. IPR/GO are excluded by default (see \code{exclude_terms}).}

\item{exclude_terms}{Character vector of term \strong{types} to exclude entirely from testing
(auto-detect and explicit \verb{terms=}). Default c("ipr","go"). Set to NULL to allow them.}

\item{sides}{Character vector among c("query","subject"). Default both.}

\item{pos_threshold}{Numeric. dNdS > pos_threshold defines "positive" (default 1).}

\item{max_dnds}{Numeric. Drop rows with dNdS >= max_dnds (default 10) or NA dNdS.}

\item{filter_expr}{Optional character with a logical expression evaluated in the data.}

\item{make_plots}{Logical; if TRUE, write a top-N bubble plot per result (default TRUE).}

\item{top_n}{Integer; number of rows for plot (default 20).}

\item{drop_rows_without_term}{Logical; if TRUE (default), rows with no term of the tested
type are removed from BOTH positives and background (annotation-aware universe).}

\item{min_total}{Minimum total occurrences (pos+nonpos) required for a term (default 0).}

\item{min_pos}{Minimum positive occurrences required for a term (default 0).}

\item{fdr_method}{One of "BH","IHW","qvalue","none". Defaults to "BH".}

\item{alpha}{FDR level for IHW weighting (default 0.05).}

\item{term_sep}{Default separator for term strings in q_\emph{/s_} columns (default ";").}

\item{term_seps}{Candidate separators to auto-detect per column (default c(";","|",",")).}

\item{term_blocklist}{Character vector of suffixes to ignore as term families.}

\item{exclude_ids}{Either a character vector of term IDs (applies to \emph{all} term types),
or a named list mapping term_type -> character vector of IDs to exclude. Default NULL.}

\item{term_trees}{Optional named list mapping term_type -> path or data.frame of a
parent/child edgelist (two columns). Enables descendant exclusion for that type.}

\item{exclude_descendants}{Logical; if TRUE, expand \code{exclude_ids} per type using
descendants from \code{term_trees[[type]]}. Default FALSE.}

\item{exclude_descendants_depth}{Integer depth limit when expanding descendants.}

\item{exclude_descendants_limit}{Hard cap on number of excluded nodes per (type).}

\item{term_metadata}{Optional named list mapping term_type -> (path or data.frame)
with columns: ID, NAME (optional: DEFINITION). Joined to results to add names/defs.}

\item{keep_unmatched_ids}{Logical; if TRUE (default), keep terms lacking metadata.}
}
\value{
In single mode: (invisibly) list of data.frames by side_term (if make_plots=FALSE)
or vector of output TSV paths (if make_plots=TRUE). In batch mode: vector of paths.
}
\description{
Reads \if{html}{\out{<comp>}}/\if{html}{\out{<comp>}}\emph{dnds_annot.tsv and tests enrichment of terms (q}* / s_* columns)
among positively selected pairs (dNdS > pos_threshold) vs the filtered background.
}
\details{
Supports optional per-term-type ID exclusion, subtree (descendant) exclusion using a
provided parent->child edgelist, and metadata joins to append names/definitions.
}
